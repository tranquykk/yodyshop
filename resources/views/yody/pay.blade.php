<!DOCTYPE html>
<html class="floating-labels" lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="YODY - Mặc Mỗi Ng&#224;y, Thoải M&#225;i Mỗi Ng&#224;y - Thanh toán đơn hàng" />
    <title>YODY - Mặc Mỗi Ngày, Thoải Mái Mỗi Ngày - Thanh toán đơn hàng</title>
    <base href="{{asset('')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <script>var Bizweb = Bizweb || {}; if(!Bizweb.fbEventId) Bizweb.fbEventId = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);return v.toString(16);}); </script>
    <script>
        !function(f, b, e, v, n, t, s){
        if (f.fbq) return; n = f.fbq = function(){
        n.callMethod?
        n.callMethod.apply(n, arguments):n.queue.push(arguments)}; if (!f._fbq) f._fbq = n;
        n.push = n; n.loaded = !0; n.version = '2.0'; n.queue =[]; t = b.createElement(e); t.async = !0;
        t.src = v; s = b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t, s)}
        (window,
        document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '761609238008442', {'external_id': '0'}
        , {'agent': 'plsapo'}); // Insert your pixel ID here.
        fbq('track', 'PageView', {}, { eventID: Bizweb.fbEventId });
    </script>
    <noscript><img height = '1' width = '1' style = 'display:none'
        src = 'https://www.facebook.com/tr?id=761609238008442&ev=PageView&noscript=1'
        /></noscript>
    <script>var Bizweb = Bizweb || {}; Bizweb.Checkout = {}; Bizweb.Checkout.fbEvent = { content_ids: ['77153299','77150690','77148485'], contents:[{"id":77153299,"quantity":2,"item_price":229500.0000},{"id":77150690,"quantity":2,"item_price":399000.0000},{"id":77148485,"quantity":1,"item_price":0.0000}] , num_items:'5', content_type:'product', value:'1257000.0000', currency:'VND' };fbq('track', 'InitiateCheckout',{ content_ids: ['77153299','77150690','77148485'], contents:[{"id":77153299,"quantity":2,"item_price":229500.0000},{"id":77150690,"quantity":2,"item_price":399000.0000},{"id":77148485,"quantity":1,"item_price":0.0000}] , num_items:'5', content_type:'product', value:'1257000.0000', currency:'VND' }, { eventID: '32627865028627324d1e9ecd5b5bd991' }); if(!Bizweb.fbEventIdInitiateCheckout)  Bizweb.fbEventIdInitiateCheckout = '32627865028627324d1e9ecd5b5bd991'</script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PFTVBVVDG1"></script>
    <script async src="//yody.api.useinsider.com/ins.js"></script>
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-PFTVBVVDG1');
        if (location.href.includes('thankyou')) { 
        window.insider_object = {
            "page": {
                "type": "Confirmation"
            }
        };
        }
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-68434573-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'UA-68434573-1');
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','gtmDataLayer','GTM-M6Q3C2K');
    </script>
    
    <link rel="shortcut icon" href="//bizweb.dktcdn.net/100/438/408/themes/890667/assets/checkout_favicon.ico?1672389635356" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css" />
    <link rel="stylesheet" href="/templates/yody/css/checkout.vendor.min.css">
    <link rel="stylesheet" href="/templates/yody/css/checkout.min.css">
    <style>
        a,
        .radio__label__icon,
        .payment-due__price,
        .spinner--active,
        .icon-print,
        .alert--info,
        .order-summary-toggle__total-recap {
        color: #fcaf17;
        }
        .input-checkbox:checked, .input-radio:checked {
        -webkit-box-shadow: 0 0 0 10px #fcaf17 inset;
        box-shadow: 0 0 0 10px #fcaf17 inset;
        }
        .product-thumbnail__quantity {
        background-color: #fcaf17;
        }
        a:hover, a:focus,
        .icon-print:hover {
        color: #BD8311;
        }
        body,.thankyou-page body,
        .modal {
        background-color: #ffffff;
        }
        body,
        .thankyou-page body,
        .thankyou-page h2,
        .section__title,
        .sidebar__title,
        .modal-title,
        .progress-bar__item--current {
        color: #000000;
        }
        .field__input:focus,
        .select2-selection:focus, .select2-search__field:focus
        {
        border-color: #fcaf17;
        box-shadow: 0 0 0 1px #fcaf17;
        }
        .select2-container--default .select2-results__option--highlighted.select2-results__option--selectable
        {
        background-color: #fcaf17;
        }
        .btn {
        background-color: #fcaf17;
        border-color: #fcaf17;
        }
        .btn:focus {
        outline-color:#fcaf17;
        }
        .btn.disabled {
        background-color: #FCC351;
        border-color: #FCC351;
        }
        .btn:hover {
        background-color: #BD8311;
        border-color: #BD8311;
        }
        .btn, .btn:hover, .btn:focus {
        color: #000000;
        }
        .main__footer {
        color: #201f53;
        }
        .sidebar hr {
        border-color: #EFF0FD;
        }
        .sidebar__header {
        border-color: #EFF0FD;
        }
        .order-summary__section ~ .order-summary__section
        {
        border-top-color: #EFF0FD;
        }
        .sidebar .total-line-table__tbody + .total-line-table__footer .total-line:first-child th:before,
        .sidebar .total-line-table__tbody + .total-line-table__footer .total-line:first-child td:before
        {
        background-color: #EFF0FD;
        }
        .sidebar:after {
        box-shadow: 0 -1px 0 #EFF0FD inset;
        }
        .sidebar:after,
        .order-summary-toggle,
        .order-summary--bordered, .thankyou-page .order-summary--bordered
        {
        background: #e7e8fc;
        }
        .product-thumbnail__quantity {
        color: #000000;
        }
        .order-summary-toggle__text,
        .sidebar__title,
        .product__description__name,
        .order-summary .order-summary__title,
        .order-summary .product-table,
        .order-summary .total-line-table {
        color: #000000
        }
        .thankyou-page .main__content p {
        color: #595959
        }
        .thankyou-page .section__content--bordered {
        border-color: #FFFFFF
        }
        .errors {
            color:#be2222;
            font-size: 14px;
            margin: 5px 0 0 2px;
        };
    </style>
    <script src="//bizweb.dktcdn.net/assets/themes_support/libphonenumber-v3.2.30.min.js?1672389635356"></script>
    <script src="/templates/yody/js/checkout.vendor.min.js"></script>
    <script src="/templates/yody/js/checkout.min.js"></script>
    <script>
        var Bizweb = Bizweb || {};
        Bizweb.id = '438408';
        Bizweb.store = 'yodyvn.mysapo.net';
        
        Bizweb.template = 'checkout';
        Bizweb.Checkout = Bizweb.Checkout || {};
        
    </script>
    <script>
        window.BizwebAnalytics = window.BizwebAnalytics || {};
        window.BizwebAnalytics.meta = window.BizwebAnalytics.meta || {};
        window.BizwebAnalytics.meta.currency = 'VND';
        window.BizwebAnalytics.tracking_url = '/s';
        var meta = {};
        
        
        for (var attr in meta) {
            window.BizwebAnalytics.meta[attr] = meta[attr];
        }
    </script>
    <script src="/templates/yody/js/stats.min4143.js"></script>
</head>
<body data-no-turbolink>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M6Q3C2K"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <header class="banner">
        <div class="wrap">
            <div class="logo logo--center">
            <a href="/">
            <img class="logo__image  logo__image--small " alt="YODY - Mặc Mỗi Ngày, Thoải Mái Mỗi Ngày" src="//bizweb.dktcdn.net/100/438/408/themes/890667/assets/checkout_logo.png?1672389635356" />
            </a>
            </div>
        </div>
    </header>
    
    <aside>
        <button class="order-summary-toggle" data-toggle="#order-summary" data-toggle-class="order-summary--is-collapsed">
        <span class="wrap">
        <span class="order-summary-toggle__inner">
        <span class="order-summary-toggle__text expandable">
        Đơn hàng (5 sản phẩm)
        </span>
        <span class="order-summary-toggle__total-recap" data-bind="getTextTotalPrice()"></span>
        </span>
        </span>
        </button>
    </aside>
    @if(\Session::has('error'))
        <script type="text/javascript">
            alertify.warning('Có lỗi khi thanh toán');
        </script>
        {{--<div class="alert alert-danger">{{ \Session::get('error') }}</div>--}}
        {{ \Session::forget('error') }}
    @endif
    @if(\Session::has('success'))
        <script type="text/javascript">
            alertify.success('Thanh toán Paypal thành công');
        </script>
        {{--<div class="alert alert-success">{{ \Session::get('success') }}</div>--}}
        {{ \Session::forget('success') }}
    @endif
    <div data-tg-refresh="checkout" id="checkout" class="content">
        <form id="checkoutForm" method="POST" action="{{route('yody.pay')}}">
            @csrf
            <div class="wrap">
            <main class="main">
                <header class="main__header">
                    <div class="logo logo--center">
                        <a href="/">
                        <img class="logo__image  logo__image--small " alt="YODY - Mặc Mỗi Ngày, Thoải Mái Mỗi Ngày" src="//bizweb.dktcdn.net/100/438/408/themes/890667/assets/checkout_logo.png?1672389635356" />
                        </a>
                    </div>
                </header>
                @if (Session::has('over'))
                    <div style="width: 100%; height: 100%; backgroup: rgba(0, 0, 0, 0.2)">
                        <section class="section section--icon-heading">
                            <div class="section__icon unprintable">
                                <svg xmlns="http://www.w3.org/2000/svg" width="72px" height="72px">
                                    <g fill="none" stroke="#8EC343" stroke-width="2">
                                        <circle cx="36" cy="36" r="35" style="stroke-dasharray:240px, 240px; stroke-dashoffset: 480px;"></circle>
                                        <path d="M17.417,37.778l9.93,9.909l25.444-25.393" style="stroke-dasharray:50px, 50px; stroke-dashoffset: 0px;"></path>
                                    </g>
                                </svg>
                            </div>
                            <div class="thankyou-message-container">
                                <h2 class="section__title">Cảm ơn bạn đã đặt hàng, YODY sẽ nhanh chóng gọi điện xác nhận lại thời gian giao hàng với bạn. YODY xin cảm ơn!</h2>
                            </div>
                        </section>
                        <section class="section unprintable">
                            <div class="field__input-btn-wrapper field__input-btn-wrapper--floating" style="justify-content: center;">
                                <a href="/" class="btn btn--large">Tiếp tục mua hàng</a>
                                <span class="text-icon-group text-icon-group--large icon-print" onclick="window.print()">
                                    <i class="fa fa-print"></i>
                                    <span>In </span>
                                </span>
                            </div>
                        </section>
                    </div>
                @else
                    
                <div class="main__content">
                    <article class="animate-floating-labels row">
                        <div class="col col--two">
                        <section class="section">
                            <div class="section__header">
                                <div class="layout-flex">
                                    <h2 class="section__title layout-flex__item layout-flex__item--stretch">
                                        <i class="fa fa-id-card-o fa-lg section__title--icon hide-on-desktop"></i>
                                        Thông tin giao hàng
                                    </h2>
                                    {{-- <a href="{{route('yody.auth.login')}}">
                                        <i class="fa-solid fa-user"></i>
                                        <span>Đăng nhập </span>
                                    </a> --}}
                                </div>
                            </div>
                            <div class="section__content">
                                <div class="fieldset">
                                    <div class="field " data-bind-class="{'field--show-floating-label': billing.name}">
                                    <div class="field__input-wrapper">
                                        <label for="fullname" class="field__label">Họ và tên</label>
                                        <input name="fullname" id="billingName" type="text" class="field__input"  value="">
                                        @error('fullname')
                                            <div class="errors">{{$message}}</div>
                                        @enderror
                                    </div>
                                    </div>
                                    <div class="field " data-bind-class="{'field--show-floating-label': billing.phone}">
                                        <div class="field__input-wrapper field__input-wrapper--connected" data-define="{phoneInput: new InputPhone(this)}">
                                            <label for="phone" class="field__label"> Số điện thoại </label>
                                            <input name="phone" id="billingPhone" type="tel" class="field__input" data-bind="billing.phone" value="">
                                        </div>
                                        @error('phone')
                                            <div class="errors">{{$message}}</div>
                                        @enderror
                                    </div>
                                    <div class="field " data-bind-class="{'field--show-floating-label': billing.address}">
                                        <div class="field__input-wrapper">
                                            <label for="address" class="field__label"> Địa chỉ </label>
                                            <input name="address" id="billingAddress" type="text" class="field__input" data-bind="billing.address" value="">
                                            @error('address')
                                                <div class="errors">{{$message}}</div>
                                            @enderror
                                        </div>
                                    </div>
                                    <div class="field field--show-floating-label ">
                                        <div class="field__input-wrapper field__input-wrapper--select2">
                                            <label for="province" class="field__label">Tỉnh thành</label>
                                            <select name="province" size="1" class="field__input field__input--select provinces" data-bind="billing.province" value="" data-address-type="province" data-address-zone="billing">
                                                <option value="">---</option>
                                                @foreach ($arrProvinces as $province)
                                                    <option value="{{$province->province_id}}">{{$province->name}}</option>
                                                @endforeach
                                            </select>
                                            @error('province')
                                                <div class="errors">{{$message}}</div>
                                            @enderror
                                        </div>
                                    </div>
                                    <div class="field field--show-floating-label ">
                                    <div class="field__input-wrapper field__input-wrapper--select2">
                                        <label for="district" class="field__label"> Quận huyện </label>
                                        <select name="district" size="1" class="field__input field__input--select districts" value="" data-bind="billing.district" data-address-type="district" data-address-zone="billing" disabled="disabled">
                                        
                                        </select>
                                        @error('district')
                                            <div class="errors">{{$message}}</div>
                                        @enderror
                                    </div>
                                    </div>
                                    <div class="field field--show-floating-label ">
                                    <div class="field__input-wrapper field__input-wrapper--select2">
                                        <label for="ward" class="field__label"> Phường xã </label>
                                        <select name="ward" size="1" class="field__input field__input--select wards" value="" data-bind="billing.ward" data-address-type="ward" data-address-zone="billing" disabled="disabled">
                                        
                                        </select>
                                        @error('ward')
                                            <div class="errors">{{$message}}</div>
                                        @enderror
                                    </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </section>
                        <div class="fieldset">
                            <h3 class="visually-hidden">Ghi chú</h3>
                            <div class="field " data-bind-class="{'field--show-floating-label': note}">
                                <div class="field__input-wrapper">
                                    <label for="note" class="field__label"> Ghi chú (tùy chọn) </label>
                                    <textarea name="note" id="note" class="field__input" data-bind="note"></textarea>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="col col--two">
                        {{-- <section class="section" data-define="{shippingMethod: ''}">
                            <div class="section__header">
                                <div class="layout-flex">
                                    <h2 class="section__title layout-flex__item layout-flex__item--stretch">
                                    <i class="fa fa-truck fa-lg section__title--icon hide-on-desktop"></i>
                                    Vận chuyển
                                    </h2>
                                </div>
                            </div>
                            <div class="section__content" data-tg-refresh="refreshShipping" id="shippingMethodList" data-define="{isAddressSelecting: true, shippingMethods: []}">
                                <div class="alert alert--loader spinner spinner--active" data-bind-show="isLoadingShippingMethod">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="spinner-loader">
                                    <use href="#spinner"></use>
                                    </svg>
                                </div>
                                <div class="alert alert-retry alert--danger hide" data-bind-event-click="handleShippingMethodErrorRetry()" data-bind-show="!isLoadingShippingMethod && !isAddressSelecting && isLoadingShippingError">
                                    <span data-bind="loadingShippingErrorMessage"></span> <i class="fa fa-refresh"></i>
                                </div>
                                <div class="content-box" data-bind-show="!isLoadingShippingMethod && !isAddressSelecting && !isLoadingShippingError"></div>
                                <div class="alert alert--info hide" data-bind-show="!isLoadingShippingMethod && isAddressSelecting">
                                    Vui lòng nhập thông tin giao hàng
                                </div>
                            </div>
                        </section> --}}
                            <section class="section">
                                <div class="section__header">
                                    <div class="layout-flex">
                                        <h2 class="section__title layout-flex__item layout-flex__item--stretch">
                                            <i class="fa fa-credit-card fa-lg section__title--icon hide-on-desktop"></i> Thanh toán
                                        </h2>
                                    </div>
                                </div>
                                <div class="section__content">
                                    <div class="content-box" data-define="{paymentMethod: undefined}">
                                        @if (!Session::has('successPaypal'))
                                            <div class="content-box__row">
                                                <div class="radio-wrapper">
                                                    <div class="radio__input">
                                                        <input name="paymentMethod" id="paymentMethod-2" type="radio" class="input-radio" data-bind="paymentMethod" value="2">
                                                    </div>
                                                    <label for="paymentMethod-2" class="radio__label">
                                                        <span class="radio__label__primary">Thanh toán khi nhận hàng (COD)</span>
                                                        <span class="radio__label__accessory">
                                                            <span class="radio__label__icon">
                                                                <i class="payment-icon payment-icon--4"></i>
                                                            </span>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class="content-box__row__desc" data-bind-show="paymentMethod == 2">
                                                    <p>Bạn chỉ phải thanh toán khi nhận được hàng</p>
                                                </div>
                                            </div>
                                            <div class="content-box__row">
                                                @php
                                                    $vnd_to_usd = $totalAll / 23083;
                                                    $totalPaypal = round($vnd_to_usd, 2);
                                                    \Session::put('totalPaypal', $totalPaypal);
                                                @endphp
                                                <a class="btn btn-primary m-3" style="width: 357px;font-size: 15px;" href="{{ route('processTransaction') }}">
                                                    <span>Thanh toán {{ \Session::get('totalPaypal') }}$ Paypal</span> 
                                                </a>
                                                <div id="paypal-button-container"></div> 
                                                <input type="hidden" id="vnd_to_usd" value="{{round($vnd_to_usd, 2)}}">
                                            </div>
                                        @else
                                            <div class="content-box__row">
                                                <div class="radio-wrapper">
                                                    <div class="radio__input">
                                                        <input name="paymentMethod" checked id="paymentMethod-1" type="radio" class="input-radio" data-bind="paymentMethod" value="1">
                                                    </div>
                                                    <label for="paymentMethod-1" class="radio__label">
                                                        <span class="radio__label__primary">Đã thanh toán bằng Paypal</span>
                                                        <span class="radio__label__accessory">
                                                            <span class="radio__label__icon">
                                                                <i class="payment-icon payment-icon--19"></i>
                                                            </span>
                                                        </span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div id="paypal-button-container"></div> 
                                        @endif
                                    </div>
                                </div>
                            </section>
                        </div>
                    </article>
                        
                    <div class="field__input-btn-wrapper field__input-btn-wrapper--vertical hide-on-desktop">
                        <button type="submit" class="btn btn-checkout spinner" data-bind-class="{'spinner--active': isSubmitingCheckout}" data-bind-disabled="isSubmitingCheckout || isLoadingReductionCode">
                        <span class="spinner-label">ĐẶT HÀNG</span>

                        <svg xmlns="http://www.w3.org/2000/svg" class="spinner-loader">
                            <use href="#spinner"></use>
                        </svg>
                        </button>
                        <a href="/cart" class="previous-link">
                        <i class="previous-link__arrow">❮</i>
                        <span class="previous-link__content">Quay về giỏ hàng</span>
                        </a>
                    </div>
                    <div id="common-alert" data-tg-refresh="refreshError">
                        <div class="alert alert--danger hide-on-desktop" data-bind-show="!isSubmitingCheckout && isSubmitingCheckoutError" data-bind="submitingCheckoutErrorMessage"></div>
                    </div>
                </div>
                <div class="main__footer unprintable">
                    <ul class="main__policy">
                        <li></li>
                        <li></li>
                        <li>
                        <a data-toggle="#service_term" data-toggle-class="hide">Điều khoản sử dụng</a>
                        </li>
                    </ul>
                    <p>Sau khi <b>hoàn tất đơn hàng</b> khoảng 60-90 phút (trong giờ hành chính), YODY sẽ nhanh chóng gọi điện xác nhận lại thời gian giao hàng với bạn. YODY xin cảm ơn!</p>
                    <div class="modal-wrapper hide" id="refund_term">
                        <div class="modal" style="display: inline-block;">
                        <div class="modal-header">
                            <h2 class="modal-title">Chính sách hoàn trả</h2>
                            <span class="close" data-toggle="#refund_term" data-toggle-class="hide">&times;</span>
                        </div>
                        <div class="modal-body">
                            <pre class="term-preview"></pre>
                        </div>
                        </div>
                    </div>
                    <div class="modal-wrapper hide" id="privacy_term">
                        <div class="modal" style="display: inline-block;">
                        <div class="modal-header">
                            <h2 class="modal-title">Chính sách bảo mật</h2>
                            <span class="close" data-toggle="#privacy_term" data-toggle-class="hide">&times;</span>
                        </div>
                        <div class="modal-body">
                            <pre class="term-preview"></pre>
                        </div>
                        </div>
                    </div>
                    <div class="modal-wrapper hide" id="service_term">
                        <div class="modal" style="display: inline-block;">
                        <div class="modal-header">
                            <h2 class="modal-title">Điều khoản sử dụng</h2>
                            <span class="close" data-toggle="#service_term" data-toggle-class="hide">&times;</span>
                        </div>
                        <div class="modal-body">
                            <pre class="term-preview">
                                <script>
                                $(".main__policy").css("display", "none");
                                function change() {
                                    $(".btn-checkout").after(
                                        '<a href="/cart" class="previous-link"><i class="previous-link__arrow">❮</i><span class="previous-link__content">Quay về giỏ hàng</span></a>'
                                    );
                                }
                                setInterval(function () {
                                    if ($(".previous-link").length < 1) {
                                        change();
                                    }
                                }, 1000);
                                var urlcheck = window.location.href;
                                if (!urlcheck.includes("/thankyou")) {
                                    $(".section__text").text(
                                        "Một số sản phẩm trong giỏ hàng không còn đủ số lượng để đặt hàng. Chúng tôi xin lỗi vì sự bất tiện này."
                                    );
                                    setInterval(function () {
                                        $('.product__price:contains("Miễn phí")').parent().addClass("free");
                                    }, 500);
                                    $(function () {
                                        var $win = $("body"); // or $box parent container
                                        $win.on("click", ".btn-checkout", function (event) {
                                            var number_gift = 0;
                                            $(".product.free").each(function () {
                                                var number = parseInt(
                                                    $(this).find(".product-thumbnail__quantity").text()
                                                );
                                                number_gift = number_gift + number;
                                            });
                                            var total = parseInt(
                                                parseInt($(".total-line__price").text().replace(/\.|đ/g, "")) / 498000
                                            );
                                            console.log(number_gift + "--" + total);
                                            if (number_gift > total) {
                                                alert(
                                                    "Giá trị đơn hàng không đủ nhận quà, vui lòng Quay về giỏ hàng xóa bớt quà tặng"
                                                );
                                                event.preventDefault();
                                            }
                                        });
                                    });
                                }
                                if (urlcheck.includes("/checkout")) {
                                    if (window.innerWidth < 999) {
                                        setTimeout(function () {
                                            $("header.banner").after(
                                                '<a href="/cart" class="backcart"><i class="previous-link__arrow">❮</i> Quay về giỏ hàng</a>'
                                            );
                                        }, 500);
                                    }
                                }
                                </script>
                                <script>
                                    (window.dataLayer = window.dataLayer || []),
                                        dataLayer.push({
                                            measurementId: "G-PFTVBVVDG1",
                                            fbPixelId: "761609238008442",
                                            orgId: "232862ea98f40d3e0dc65da6acdca7a6",
                                            enableGA4: !0,
                                            userId: "",
                                        }),
                                        (function (b, d, e, a, g) {
                                            (b[a] = b[a] || []),
                                                b[a].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
                                            var f = d.getElementsByTagName(e)[0],
                                                c = d.createElement(e);
                                            (c.async = !0),
                                                (c.src =
                                                    "https://www.googletagmanager.com/gtm.js?id=" +
                                                    g +
                                                    ("dataLayer" != a ? "&l=" + a : "")),
                                                f.parentNode.insertBefore(c, f);
                                        })(window, document, "script", "dataLayer", "GTM-M6MNVJG");
                                </script>
                                <script>
                                    $("#checkoutForm").change(function () {
                                        var url = window.location.href;
                                        var items = [];
                                    
                                        var checkDiscount = false;
                                        $(".product-table .product").each(function () {
                                            if (
                                                $(this).find(".product__description .product__description__property")
                                                    .length == 2
                                            ) {
                                                checkDiscount = true;
                                            }
                                            var item = {
                                                item_id: "",
                                                item_name: $(this).find(".product__description__name").html(),
                                                affiliation: "",
                                                coupon: "",
                                                currency: "",
                                                discount: 0,
                                                index: 0,
                                                item_brand: "",
                                                item_category: "",
                                                item_category2: "",
                                                item_category3: "",
                                                item_category4: "",
                                                item_category5: "",
                                                item_list_id: "",
                                                item_list_name: "",
                                                item_variant: "",
                                                location_id: "",
                                                price: $(this).find(".product__price").html(),
                                                quantity: $(this).find(".product-thumbnail__quantity").html(),
                                            };
                                            items.push(item);
                                        });
                                        var validateForm = true;
                                        var billingName = $("#billingName").val();
                                        if (billingName.trim() == "") {
                                            validateForm = false;
                                        }
                                        var billingPhone = $("#billingPhone").val();
                                        if (billingPhone.trim() == "") {
                                            validateForm = false;
                                        }
                                        var billingAddress = $("#billingAddress").val();
                                        if (billingAddress.trim() == "") {
                                            validateForm = false;
                                        }
                                        var billingProvince = $("#billingProvince").val();
                                        var billingProvinceName = $("#select2-billingProvince-container").html();
                                        if (billingProvince == "") {
                                            validateForm = false;
                                        }
                                        var billingDistrict = $("#billingDistrict").val();
                                        var billingDistrictName = $("#select2-billingDistrict-container").html();
                                        if (billingDistrict == "") {
                                            validateForm = false;
                                        }
                                        var billingWard = $("#billingWard").val();
                                        var billingWardName = $("#select2-billingWard-container").html();
                                        if (billingWard == "") {
                                            validateForm = false;
                                        }
                                        var paymentMethod = $('input[name="paymentMethod"]:checked').val();
                                        var paymentMethodName = $('input[name="paymentMethod"]:checked')
                                            .closest(".radio-wrapper")
                                            .find(".radio__label__primary")
                                            .html();
                                        if (paymentMethod !== undefined && paymentMethod.trim() == "") {
                                            validateForm = false;
                                        }
                                        if (validateForm) {
                                            dataLayer.push({
                                                event: "pangoTrack",
                                                eventAction: "begin_checkout",
                                                user_data: {
                                                    always_use: true,
                                                    email_address: "",
                                                    phone_number: billingPhone,
                                                },
                                                currency: "",
                                                value: 0,
                                                coupon: "",
                                                ecommerce: {
                                                    items: items,
                                                },
                                                cdpData: {
                                                    properties: {
                                                        name: billingName,
                                                        phone: billingPhone,
                                                        address: billingAddress,
                                                        province: billingProvinceName,
                                                        district: billingDistrictName,
                                                        ward: billingWardName,
                                                        payment_method: paymentMethodName,
                                                        note: $("#note").val(),
                                                        redirect_checkout_url: url,
                                                        discount: checkDiscount ? "discount" : "full_price",
                                                    },
                                                },
                                            });
                                        }
                                    });
                                    
                                    $("body").on("click", ".btn-checkout", function (event) {
                                        var url = window.location.href;
                                        var items = [];
                                        $(".product-table .product").each(function () {
                                            var item = {
                                                item_id: "",
                                                item_name: $(this).find(".product__description__name").html(),
                                                affiliation: "",
                                                coupon: "",
                                                currency: "",
                                                discount: 0,
                                                index: 0,
                                                item_brand: "",
                                                item_category: "",
                                                item_category2: "",
                                                item_category3: "",
                                                item_category4: "",
                                                item_category5: "",
                                                item_list_id: "",
                                                item_list_name: "",
                                                item_variant: "",
                                                location_id: "",
                                                price: $(this).find(".product__price").html(),
                                                quantity: $(this).find(".product-thumbnail__quantity").html(),
                                            };
                                            items.push(item);
                                        });
                                        var validateForm = true;
                                        var billingName = $("#billingName").val();
                                        if (billingName.trim() == "") {
                                            validateForm = false;
                                        }
                                        var billingPhone = $("#billingPhone").val();
                                        if (billingPhone.trim() == "") {
                                            validateForm = false;
                                        }
                                        var billingAddress = $("#billingAddress").val();
                                        if (billingAddress.trim() == "") {
                                            validateForm = false;
                                        }
                                        var billingProvince = $("#billingProvince").val();
                                        var billingProvinceName = $("#select2-billingProvince-container").html();
                                        if (billingProvince == "") {
                                            validateForm = false;
                                        }
                                        var billingDistrict = $("#billingDistrict").val();
                                        var billingDistrictName = $("#select2-billingDistrict-container").html();
                                        if (billingDistrict == "") {
                                            validateForm = false;
                                        }
                                        var billingWard = $("#billingWard").val();
                                        var billingWardName = $("#select2-billingWard-container").html();
                                        if (billingWard == "") {
                                            validateForm = false;
                                        }
                                        var paymentMethod = $('input[name="paymentMethod"]:checked').val();
                                        var paymentMethodName = $('input[name="paymentMethod"]:checked')
                                            .closest(".radio-wrapper")
                                            .find(".radio__label__primary")
                                            .html();
                                        if (paymentMethod !== undefined && paymentMethod.trim() == "") {
                                            validateForm = false;
                                        }
                                        if (validateForm) {
                                            // const totalPriceTemp = Number($(".total-line-table__footer").find(".payment-due__price").text().replace(/[^0-9-]+/g, ""));
                                            // const totalPriceFinal = Number.isNaN(totalPriceTemp) ? 0 : totalPriceTemp;
                                            dataLayer.push({
                                                event: "pangoTrack",
                                                eventAction: "purchase",
                                                user_data: {
                                                    always_use: true,
                                                    email_address: "",
                                                    phone_number: billingPhone,
                                                },
                                                currency: "",
                                                value: 0,
                                                coupon: "",
                                                ecommerce: {
                                                    items: items,
                                                },
                                                cdpData: {
                                                    properties: {
                                                        name: billingName,
                                                        phone: billingPhone,
                                                        address: billingAddress,
                                                        province: billingProvinceName,
                                                        district: billingDistrictName,
                                                        ward: billingWardName,
                                                        payment_method: paymentMethodName,
                                                        note: $("#note").val(),
                                                        redirect_checkout_url: url,
                                                    },
                                                },
                                            });
                                            
                                            // try {
                                            //     if (window.gtag) {
                                            //         gtag("event", "purchase", {
                                            //             value: totalPriceFinal,
                                            //             items: items,
                                            //         });
                                            //     }
                                            // } catch (e) {
                                            //     console.error("ga err script", e);
                                            // }
                                            dataLayer.push({
                                                event: "pangoTrack",
                                                eventAction: "generate_lead",
                                                user_data: {
                                                    email_address: "",
                                                    phone_number: billingPhone,
                                                    address: {
                                                        first_name: billingName,
                                                        last_name: "",
                                                        city: "",
                                                        region: "",
                                                        postal_code: "",
                                                        country: "",
                                                    },
                                                    form_key: "info_purchase",
                                                    form_name: "info_purchase",
                                                    form_vs: "",
                                                    cf: "",
                                                },
                                                cdpData: {
                                                    properties: {
                                                        name: billingName,
                                                        phone: billingPhone,
                                                        address: billingAddress,
                                                        province: billingProvinceName,
                                                        district: billingDistrictName,
                                                        ward: billingWardName,
                                                        payment_method: paymentMethodName,
                                                        note: $("#note").val(),
                                                        redirect_checkout_url: url,
                                                        discount: checkDiscount ? "discount" : "full_price",
                                                    },
                                                },
                                            });
                                        }
                                    });
                                </script>
                                <style>
                                    @media (max-width: 999px) {
                                        .order-summary--is-collapsed .order-summary--collapse-element {
                                            height: auto !important;
                                            visibility: visible;
                                            overflow: hidden;
                                            padding-top: 1em;
                                            padding-bottom: 1em;
                                        }

                                        .backcart {
                                            display: block;
                                            text-align: center;
                                            background: #f1f2fe;
                                            padding: 10px 0;
                                            border-top: solid 1px #ddd;
                                        }
                                    }
                                </style>
                            </pre>
                        </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <aside class="sidebar">
                <div class="sidebar__header">
                    <h2 class="sidebar__title">
                        Đơn hàng ({{$totalQuantity}} sản phẩm)
                    </h2>
                </div>
                <div class="sidebar__content">
                    <div id="order-summary" class="order-summary order-summary--is-collapsed">
                        <div class="order-summary__sections">
                        <div class="order-summary__section order-summary__section--product-list order-summary__section--is-scrollable order-summary--collapse-element">
                            <table class="product-table">
                                <caption class="visually-hidden">Chi tiết đơn hàng</caption>
                                <thead class="product-table__header">
                                    <tr>
                                    <th>
                                        <span class="visually-hidden">Ảnh sản phẩm</span>
                                    </th>
                                    <th>
                                        <span class="visually-hidden">Mô tả</span>
                                    </th>
                                    <th>
                                        <span class="visually-hidden">Sổ lượng</span>
                                    </th>
                                    <th>
                                        <span class="visually-hidden">Đơn giá</span>
                                    </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (session()->has('newCart'))
                                        @foreach (session()->get('newCart') as $key => $item)
                                            @php
                                                $total = $item['price'] * $item['quantity'];
                                                $totalAll += $total;
                                                $urlPicture = 'storage/templates/yody/images/'.$item['picture'];
                                            @endphp
                                            <tr class="product">
                                                <td class="product__image">
                                                    <div class="product-thumbnail">
                                                        <div class="product-thumbnail__wrapper" data-tg-static>
                                                            <img src="{{$urlPicture}}" alt="" class="product-thumbnail__image" />
                                                        </div>
                                                        <span class="product-thumbnail__quantity">{{$item['quantity']}}</span>
                                                    </div>
                                                </td>
                                                <th class="product__description">
                                                    <span class="product__description__name"> {{$item['name']}} </span>
                                                    <span class="product__description__property"> Size : {{$item['size']}} </span>
                                                </th>
                                                <td class="product__quantity visually-hidden"><em>Số lượng:</em> {{$item['quantity']}}</td>
                                                <td class="product__price"> {{number_format($item['price'], 0, ',', '.')}}đ </td>
                                            </tr>
                                        @endforeach
                                    @endif
                                </tbody>
                            </table>
                        </div>
                        {{-- <div class="order-summary__section order-summary__section--discount-code" data-tg-refresh="refreshDiscount" id="discountCode">
                            <h3 class="visually-hidden">Mã khuyến mại</h3>
                            <div class="edit_checkout animate-floating-labels">
                                <div class="fieldset">
                                    <div class="field ">
                                    <div class="field__input-btn-wrapper">
                                        <div class="field__input-wrapper">
                                            <label for="reductionCode" class="field__label">Nhập mã giảm giá</label>
                                            <input name="reductionCode" id="reductionCode" type="text" class="field__input" autocomplete="off" data-bind-disabled="isLoadingReductionCode" data-bind-event-keypress="handleReductionCodeKeyPress(event)" data-define="{reductionCode: null}" data-bind="reductionCode">
                                        </div>
                                        <button class="field__input-btn btn spinner" type="button" data-bind-disabled="isLoadingReductionCode || !reductionCode" data-bind-class="{'spinner--active': isLoadingReductionCode, 'btn--disabled': !reductionCode}" data-bind-event-click="applyReductionCode()">
                                            <span class="spinner-label">Áp dụng</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="spinner-loader">
                                                <use href="#spinner"></use>
                                            </svg>
                                        </button>
                                    </div>
                                    <p class="field__message field__message--error field__message--error-always-show" data-bind-show="!isLoadingReductionCode && isLoadingReductionCodeError" data-bind="loadingReductionCodeErrorMessage"></p>
                                    </div>
                                </div>
                            </div>
                        </div> --}}
                        <div class="order-summary__section order-summary__section--total-lines order-summary--collapse-element" data-define="{subTotalPriceText: '1.257.000đ'}" data-tg-refresh="refreshOrderTotalPrice" id="orderSummary">
                            <table class="total-line-table">
                                <caption class="visually-hidden">Tổng giá trị</caption>
                                <thead>
                                    <tr>
                                    <td><span class="visually-hidden">Mô tả</span></td>
                                    <td><span class="visually-hidden">Giá tiền</span></td>
                                    </tr>
                                </thead>
                                <tbody class="total-line-table__tbody">
                                    <tr class="total-line total-line--subtotal">
                                    <th class="total-line__name">
                                        Tạm tính
                                    </th>
                                    <td class="total-line__price">{{number_format($totalAll, 0, ',', '.')}}đ</td>
                                    </tr>
                                    <tr class="total-line total-line--shipping-fee">
                                    {{-- <th class="total-line__name">
                                        Phí vận chuyển
                                    </th> 
                                    <td class="total-line__price" data-bind="getTextShippingPrice()"></td> --}}
                                    </tr>
                                </tbody>
                                <tfoot class="total-line-table__footer">
                                    <tr class="total-line payment-due">
                                    <th class="total-line__name">
                                        <span class="payment-due__label-total">
                                        Tổng cộng
                                        </span>
                                    </th>
                                    <td class="total-line__price">
                                        <span class="payment-due__price">{{number_format($totalAll, 0, ',', '.')}}</span>
                                    </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="order-summary__nav field__input-btn-wrapper hide-on-mobile layout-flex--row-reverse">
                            <button type="submit" class="btn btn-checkout spinner" data-bind-class="{'spinner--active': isSubmitingCheckout}" data-bind-disabled="isSubmitingCheckout || isLoadingReductionCode">
                                <span class="spinner-label">ĐẶT HÀNG</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="spinner-loader">
                                    <use href="#spinner"></use>
                                </svg>
                            </button>
                            <a href="/cart" class="previous-link">
                            <i class="previous-link__arrow">❮</i>
                            <span class="previous-link__content">Quay về giỏ hàng</span>
                            </a>
                        </div>
                        <div id="common-alert-sidebar" data-tg-refresh="refreshError">
                            <div class="alert alert--danger hide-on-mobile hide" data-bind-show="!isSubmitingCheckout && isSubmitingCheckoutError" data-bind="submitingCheckoutErrorMessage"></div>
                        </div>
                        </div>
                    </div>
                </div>
            </aside>
            </div>
        </form>
        <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <symbol id="spinner">
            <svg viewBox="0 0 30 30">
                <circle stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-dasharray="85%" cx="50%" cy="50%" r="40%">
                    <animateTransform attributeName="transform" type="rotate" from="0 15 15" to="360 15 15" dur="0.7s" repeatCount="indefinite" />
                </circle>
            </svg>
            </symbol>
        </svg>
    </div>
    {{-- <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> --}}
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vaafb692b2aea4879b33c060e79fe94621666317369993" integrity="sha512-0ahDYl866UMhKuYcW078ScMalXqtFJggm7TmlUtp0UlD4eQk0Ixfnm5ykXKvGJNFjLMoortdseTfsRT8oCfgGA==" data-cf-beacon='{"rayId":"7819a402d9366bc1","token":"62e31e90875544a5bb667a4f4076dc43","version":"2022.11.3","si":100}' crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $(".provinces").change(function() {
                var pid = $(".provinces").val();
                // alert(pid);
                $.get("/district", {province_id: pid}, function(data){
                    $(".districts").html(data);
                });
            });

            $(".districts").change(function() {
                var did = $(".districts").val();
                // alert(did);
                $.get("/ward", {district_id: did}, function(rs){
                    $(".wards").html(rs);
                });
            });
        })
    </script>
    <script src="https://www.paypal.com/sdk/js?client-id=AdLj8up-gCyJ5wk_WVJLl1GrP63YJMrKGla3ZvfE5-6dSELArFanz57oOnKzPcYoACIR991fogPvFsdh&currency=USD&locale=en_US"></script>
                   
    {{-- <script type="text/javascript">
        var usd = document.getElementById('vnd_to_usd').value;
        paypal.Buttons({
        // Sets up the transaction when a payment button is clicked
        createOrder: (data, actions) => {
            return actions.order.create({
            purchase_units: [{
                amount: {
                value: `${usd}` // Can also reference a variable or function
                }
            }]
            });
        },
        // Finalize the transaction after payer approval
        onApprove: (data, actions) => {
            return actions.order.capture().then(function(orderData) {
            // Successful capture! For dev/demo purposes:
            console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
            const transaction = orderData.purchase_units[0].payments.captures[0];
            alert(`Cảm ơn bạn đã mua hàng của chúng thôi`);
            // When ready to go live, remove the alert and show a success message within this page. For example:
            // const element = document.getElementById('paypal-button-container');
            // element.innerHTML = '<h3>Thank you for your payment!</h3>';
            // Or go to another URL:  actions.redirect('thank_you.html');
            });
        }
        }).render('#paypal-button-container');
    </script> --}}
    @endif

</body>
</html>